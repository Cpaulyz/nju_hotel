# 软件体系结构文档模板

## 文档修改历史

| 修改人员 | 日期       | 修改原因                               | 版本号  |
| :------: | ---------- | -------------------------------------- | ------- |
|  陈彦泽  | 2020/04/18 | 完成逻辑视图、组合视图、信息视角的初稿 | v1.0.0  |
|  陈彦泽  | 2020/04/20 | 修改组合视图                           | v1.0.1  |
|  孟俊豪  | 2020/04/24 | 完成业务逻辑层分解                     | v1.0.2  |
|  苗轶轩  | 2020/04/24 | 完成模块职责和数据层分解               | V1.0.3  |
|  孟俊豪  | 2020/04/25 | 添加业务逻辑层RoomService              | v1.0.4  |
|   柴绮   | 2020/04/25 | 完成引言，产品概述，用户界面层         | v1.0.5  |
|  陈彦泽  | 2020/04/25 | 调整了一下格式和表述，添加目录         | v.1.0.6 |

## 目录

[软件体系结构文档模板](#软件体系结构文档模板)

- [文档修改历史](#文档修改历史)
- [目录](#目录)
- [1. 引言](#1-引言)
  - [1.1 编制目的](#11-编制目的)
  - [1.2 词汇表](#12-词汇表)
  - [1.3 参考资料](#13-参考资料)
- [2. 产品概述](#2-产品概述)
- [3. 逻辑视图](#3-逻辑视图)
- [4. 组合视图](#4-组合视图)
  - [4.1 开发包图](#41-开发包图)
  - [4.2 运行时进程](#42-运行时进程)
  - [4.3 物理部署](#43-物理部署)
- [5. 架构设计](#5-架构设计)
  - [5.1 模块职责](#51-模块职责)
  - [5.2 用户界面层分解](#52-用户界面层分解)
    - [5.2.1 职责](#521-展示层模块的职责)
    - [5.2.2 接口规范](#522-展示层模块的接口规范)
  - [5.3 业务逻辑层分解](#53-业务逻辑层分解)
    - [5.3.1 职责](#531-职责)
    - [5.3.2 接口规范](#532-接口规范)
  - [5.4 数据层分解](#54-数据层分解)
    - [5.4.1 数据层模块的职责](#541-数据层模块的职责)
    - [5.4.2 接口规范](#542-接口规范)
  - [6. 信息视角](#6-信息视角)
    - [6.1 数据持久化对象](#61-数据持久化对象)
    - [6.2 数据库表](#62-数据库表)

## 1. 引言

### 1.1 编制目的

本报告详细完成对互联网酒店预定系统的概要设计，达到指导详细设计和开发的目的，同时实现和测试人员及用户的沟通。

本报告面向开发人员、测试人员及最终用户编写，是了解系统的导航。

### 1.2 词汇表

| 词汇名称 |             词汇含义             |       备注       |
| :------: | :------------------------------: | :--------------: |
|   用户   | 客户、酒店工作人员和网站工作人员 | 管理员不算是用户 |
|          |                                  |                  |



### 1.3 参考资料

1.IEEE标准

2.互联网酒店预订系统需求规格说明文档

3.互联网酒店预订系统用例描述文档

4.互联网酒店预订系统用例文档

5.软件工程与计算（卷二）软件开发的技术基础

## 2. 产品概述

​	互联网酒店预订系统是为酒店的在线预定系统，开发的目的是帮助顾客能在线上直接完成酒店的预定和酒店在线上处理订单，为顾客提供的服务包括搜索酒店、选择酒店、预定酒店、查看个人相关记录信息，为酒店提供的服务包括处理订单，查看顾客信息，更新库存，实现优惠促销等。

​	互联网酒店预订系统，希望可以为上线酒店减少线下工作、经营成本，吸引更多顾客，提高顾客满意度和盈利率。



## 3. 逻辑视图

​        互联网酒店预订系统中，选择了分层体系结构风格，将系统分为4层（展示层、控制层、业务逻辑层、数据层）能够很好地示意整个高层抽象。

​        展示层采用MVVM架构风格的Vue作为框架，完成页面的实现；业务逻辑层包含业务逻辑处理的实现；数据层负责数据的持久化和访问。

​        分层逻体系结构的逻辑视图和逻辑设计方案如下图所示。

![](https://software-2.oss-cn-beijing.aliyuncs.com/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/pkg_1%282%29.png)


![](https://software-2.oss-cn-beijing.aliyuncs.com/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/pkg_2%282%29.png)


## 4. 组合视图

### 4.1 开发包图

​        互联网酒店预订系统的最终开发包设计如表1所示。

**表1 互联网酒店预订系统的最终开发包设计**


|       开发包       | 依赖的其他开发包                                             |
| :----------------: | ------------------------------------------------------------ |
|     views.main     | views.admin、views.user、views.hotel、views.hotelManager、vo |
|    views.admin     | controller.admin、axios、界面类库包、vo                      |
|  controller.admin  | bl.admin、vo、axios                                          |
|      bl.admin      | data.admin、po、vo                                           |
|     data.admin     | databseutility                                               |
|     views.user     | controller.user、controller.order、axios、界面类库包、vo     |
|  controller.user   | bl.user、vo、axios                                           |
|      bl.user       | data.user、po、vo                                            |
|     data.user      | databseutility                                               |
|    views.hotel     | controller.hotel、controller.order、controller.coupon、axios、界面类库包、vo |
|  controller.hotel  | bl.hotel、vo、axios                                          |
|      bl.hotel      | bl.user、data.hotel、po、vo                                  |
|     data.hotel     | databseutility                                               |
| views.hotelManager | controller.hotel、controller.order、controller.coupon、axios、界面类库包、vo |
|  controller.order  | bl.order、vo、axios                                          |
|      bl.order      | bl.user、bl.hotel、data.order、po、vo                        |
|     data.order     | databseutility                                               |
| controller.coupon  | conponbl、vo、axios                                          |
|     bl.coupon      | data.coupon、po、vo                                          |
|    data.coupon     | databseutility                                               |
|         vo         |                                                              |
|         po         |                                                              |
|       config       |                                                              |
|     界面类库包     |                                                              |
|       axios        | HTTP                                                         |
|  databaseutility   | mybatis                                                      |

​	    由于Web开发的特殊性， 互联网酒店预订系统的客户端程序为浏览器，只需用户自行安装浏览器即可。在本文档中的客户端开发包图为前端开发包图。客户端和服务器端开发包图如下图所示。

互联网酒店预订系统客户端开发包图：

![](https://software-2.oss-cn-beijing.aliyuncs.com/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/client.png)

互联网酒店预订系统服务端开发包图：

![](https://software-2.oss-cn-beijing.aliyuncs.com/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/ser.png)




### 4.2 运行时进程

​	    互联网酒店预订系统中，会有多个客户端进程和一个服务器端进程。结合部署图，客户端进程在客户端机器上运行，服务器端进程在服务器端机器上运行。进程图如下所示。

![](https://software-2.oss-cn-beijing.aliyuncs.com/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/%E8%BF%90%E8%A1%8C%E6%97%B6%E8%BF%9B%E7%A8%8B.png)


### 4.3 物理部署

​	    互联网酒店预订系统中，客户端构件是放在客户端机器上的，服务器端构件是放在服务器端机器上的。在客户端节点上，只需要安装现代浏览器（即支持HTML、XHTML、CSS、ECMAScript及W3C DOM标准的浏览器）即可。具体部署图如下所示。

![icon](https://software-2.oss-cn-beijing.aliyuncs.com/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/%E9%83%A8%E7%BD%B2%E5%9B%BE2.png)

## 5. 架构设计

- 描述功能分解和如何在不同的层中安排软件模块
  - 描述架构中的对象，包含架构图
  - 描述组件接口信息
    - 包括：语法、前置条件、后置条件

### 5.1 模块职责

由于Web开发的特殊性， 互联网酒店预订系统的客户端程序为浏览器，只需用户自行安装浏览器即可。

服务器端模块视图：

<img src="https://software-engineering.oss-cn-beijing.aliyuncs.com/interface_responsibility.png" style="zoom:50%;" />

**表2 服务器端各层的职责**


|     层     | 职责                                             |
| :--------: | ------------------------------------------------ |
|  启动模块  | 负责启动系统，初始化网络通信机制和数据服务的连接 |
|   展示层   | 基于Web的互联网酒店预订系统的客户端用户界面      |
|  接口模块  | 负责客户端和服务器端的通信及数据传递             |
| 业务逻辑层 | 对用户界面的输入进行响应并执行业务处理逻辑       |
| 数据服务层 | 负责业务逻辑层和数据层的数据传递                 |
|   数据层   | 负责数据的持久化和数据的访问                     |

每一层只是使用下方直接接触的层。层与层之间仅仅是通过接口的调用来完成的。层之间调用的接口如表3所示。

**表3 层之间调用的接口**


|                             接口                             | 服务调用方         | 服务提供方         |
| :----------------------------------------------------------: | ------------------ | ------------------ |
|                             API                              | 服务器端展示层     | 服务器端接口模块   |
| AdminService<br>CouponService<br>HotelService<br>RoomService<br>OrderService<br>AccountService | 服务器端接口模块   | 服务器端业务逻辑层 |
| AdminMapper<br>CouponMapper<br>HotelMapper<br>RoomMapper<br>OrderMapper<br>AccountMapper<br />CreditMapper<br />CommentMapper | 服务器端业务逻辑层 | 服务器端数据服务层 |
|                             XML                              | 服务器端数据服务层 | 服务器端数据层     |

借用增加订单用例来说明层之间的调用，如图所示。每一层之间都是由上层依赖了一个接口（需接口），而下层实现这个接口（供接口）。OrderService 提供了 OrderUI 界面所需要的所有业务逻辑功能。OrderMapper 提供了对数据库的增、删、改、查等操作。这样的实现就大大降低了层与层之间的耦合。

添加订单用例层之间调用的接口：

![](https://software-engineering.oss-cn-beijing.aliyuncs.com/layerInterface.png)




### 5.2 用户界面层分解

根据需求，系统能在20个用户界面：登录界面、用户界面、网站管理员界面、网站营销人员页面、酒店工作人员界面、注册会员、个人信息页面、搜索酒店页面、浏览酒店页面、生成订单页面、浏览订单页面、取消订单页面、添加酒店及其工作人员页面、用户管理、制定网站促销策略页面、浏览异常订单页面、维护酒店信息页面、录入客房信息页面、制定酒店促销策略页面、浏览订单页面。

![]()

#### 5.2.1 职责



|   服务名    | 服务                               |
| :---------: | ---------------------------------- |
| manageUser  | 负责管理系统管理员的账户           |
|  hotelList  | 负责展示酒店列表和特定酒店详细信息 |
|   header    | 负责页面的跳转                     |
| manageHotel | 负责管理酒店列表，显示优惠政策     |
|    Info     | 负责修改用户信息，用户订单         |
|    login    | 负责显示登录界面                   |
| hotelDetail | 负责显示酒店详细信息               |



#### 5.2.2 接口规范

##### 5.2.2.1 manageUser模块的接口规范

提供的服务（供接口）


| manageUser.addManager |                    |
| --------------------- | ------------------ |
| 语法                  | addManager();      |
| 前置条件              | 以管理员的身份登录 |
| 后置条件              | 调用addManagerAPI  |

需要的接口（需接口）

| 服务名                       | 服务                               |
| ---------------------------- | ---------------------------------- |
| AdminService.registerAccount | 在数据库User表中加入新管理人员数据 |

##### 5.2.2.2 hotelList模块的接口规范

提供的服务（供接口）


| hotelList.pageChange |                            |
| -------------------- | -------------------------- |
| 语法                 | pageChange(page,pagesize); |
| 前置条件             | 无                         |
| 后置条件             | 酒店工作人员添加成功或失败 |

| hotelList.jumptoDetails |                    |
| ----------------------- | ------------------ |
| 语法                    | jumptoDetails(id); |
| 前置条件                | 无                 |
| 后置条件                | 跳转至酒店详情显示 |

需要的接口（需接口）

| 服务名                            | 服务                     |
| --------------------------------- | ------------------------ |
| HotelService.retrieveHotels       | 新建一个酒店工作人员对象 |
| HotelService.retrieveHotelDetails | 查找所有的酒店工作人员   |

##### 5.2.2.3 header模块的接口规范

提供的服务（供接口）


| header.selectMenu |                                                    |
| ----------------- | -------------------------------------------------- |
| 语法              | List<Coupon> getMatchOrderCoupon(OrderVO orderVO); |
| 前置条件          | 无                                                 |
| 后置条件          | 跳转至指定页面                                     |

| header.jumpToHome |                              |
| ----------------- | ---------------------------- |
| 语法              | jumpToHome();                |
| 前置条件          | 酒店ID符合输入规则           |
| 后置条件          | 根据酒店ID查找相应的优惠策略 |

| header.jumpToUserInfo |                      |
| --------------------- | -------------------- |
| 语法                  | jumpToUserInfo;      |
| 前置条件              | 无                   |
| 后置条件              | 添加酒店满减优惠策略 |

##### 5.2.2.4 manageHotel模块的接口规范


提供的服务（供接口）

| manageHotel.addHotel |                                                    |
| -------------------- | -------------------------------------------------- |
| 语法                 | addHotel();                                        |
| 前置条件             | 无                                                 |
| 后置条件             | 查看是否存在相应的酒店工作人员；酒店创建成功或失败 |

| manageHotel.addRoom |                                                              |
| ------------------- | ------------------------------------------------------------ |
| 语法                | void updateRoomInfo(Integer hotelId, String roomType,Integer rooms); |
| 前置条件            | 无                                                           |
| 后置条件            | 显示添加后的结果，更新fangjian库存                           |

| manageHotel.showCoupon |                                              |
| ---------------------- | -------------------------------------------- |
| 语法                   | showCoupon();                                |
| 前置条件               | 无                                           |
| 后置条件               | 查找是否存在相应的酒店，恢复某类型的房间数量 |

| manageHotel.deleteHotel |                    |
| ----------------------- | ------------------ |
| 语法                    | deleteHotel();     |
| 前置条件                | 无                 |
| 后置条件                | 查找所有的酒店信息 |

| manageHotel.deleteOrder |                                      |
| ----------------------- | ------------------------------------ |
| 语法                    | deleteOrder();                       |
| 前置条件                | 无                                   |
| 后置条件                | 查找是否存在相应的酒店，返回酒店信息 |

需要的接口（需接口）

| 服务名                          | 服务                     |
| ------------------------------- | ------------------------ |
| HotelService.addHotel           | 添加一个酒店             |
| RoomService.insertRoomInfo      | 添加客房信息             |
| CouponService.getHotelAllcoupon | 返回某个酒店所有优惠策略 |
| HotelService.updateRoomInfo     | 更新客房信息             |

##### 5.2.2.5 info模块的接口规范


提供的服务（供接口）

| Info.saveModify |                                                    |
| --------------- | -------------------------------------------------- |
| 语法            | saveModify();                                      |
| 前置条件        | 修改内容符合输入规则、数据要求                     |
| 后置条件        | 查找是否有足够多相应类型的房间；订单创建成功或失败 |

| Info.modifyInfo |                        |
| --------------- | ---------------------- |
| 语法            | modifyInfo();          |
| 前置条件        | 无                     |
| 后置条件        | modify的状态设置为true |

| Info.cancelModify |                         |
| ----------------- | ----------------------- |
| 语法              | cancelModify();         |
| 前置条件          | 无                      |
| 后置条件          | modify的状态设置为false |

| Info.confirmCancelOrder |                                    |
| ----------------------- | ---------------------------------- |
| 语法                    | confirmCancelOrder(order);         |
| 前置条件                | 用户选择撤销订单                   |
| 后置条件                | 根据订单ID查找相应的订单并撤销订单 |

| Info.cancelCancelOrder |                              |
| ---------------------- | ---------------------------- |
| 语法                   | cancelCancelOrder();         |
| 前置条件               | 用户选择取消撤销订单         |
| 后置条件               | 根据酒店ID查找相应酒店的订单 |

需要的接口（需接口）

| 服务名                        | 服务                                                 |
| ----------------------------- | ---------------------------------------------------- |
| AccountService.updateUserInfo | 调用数据层接口更新个人信息并返回ResponseVO           |
| OrderService.annulOrder       | 调用数据层接口撤销订单，更新客房信息并返回ResponseVO |

##### 5.2.2.6 login模块的接口规范


提供的服务（供接口）

| login.addManager |                   |
| ---------------- | ----------------- |
| 语法             | addManager();     |
| 前置条件         | 以管理员身份登录  |
| 后置条件         | 调用addManagerAPI |

需要的接口（需接口）

| 服务名                  | 服务                                 |
| ----------------------- | ------------------------------------ |
| AdminService.addManager | 向数据库User表中插入新管理人员的数据 |

##### 5.2.2.7 hotelDetail模块的接口规范


提供的服务（供接口）

| hotelDetail.beforeMount |                            |
| ----------------------- | -------------------------- |
| 语法                    | beforeMount()              |
| 前置条件                | 无                         |
| 后置条件                | 检查用户输入的邮箱是否有效 |

| hotelDetail.beforeRouteUpdate |                                   |
| ----------------------------- | --------------------------------- |
| 语法                          | beforeRouteUpdate(to, from, next) |
| 前置条件                      | 用户输入密码                      |
| 后置条件                      | modify的状态设置为true            |

### 5.3 业务逻辑层分解

业务逻辑层包含多个针对界面的业务逻辑处理对象
![](http://assets.processon.com/chart_image/5ea0fb4ee0b34d05e1a5f218.png)

#### 5.3.1 职责

| 模块           | 职责                                             |
| -------------- | ------------------------------------------------ |
| AccountService | 负责实现客户登录注册以及维护个人信息所需要的服务 |
| AdminService   | 负责实现注册和查看酒店工作人员信息所需要的服务   |
| CouponService  | 负责实现增删改查酒店和网站的优惠策略所需要的服务 |
| HotelService   | 负责实现添加、查看和维护酒店信息所需要的服务     |
| OrderService   | 负责生成、查看或撤销订单信息所需要的服务         |
| RoomService    | 负责实现添加、查看和维护酒店房间信息所需要的服务 |

#### 5.3.2 接口规范

业务逻辑层的模块AccountService、模块AdminService、模块CouponService、模块HotelService、模块OrderService和RoomService的接口规范如下所示

##### 5.3.2.1 AccountService模块的接口规范


提供的服务（供接口）

| AccountService.registerAccount |                                            |
| ------------------------------ | ------------------------------------------ |
| 语法                           | ResponseVO registerAccount(UserVO userVO); |
| 前置条件                       | 用户输入注册账号所需的信息                 |
| 后置条件                       | 客户创建成功或失败                         |

| AccountService.login |                                    |
| -------------------- | ---------------------------------- |
| 语法                 | User login(UserForm userForm);     |
| 前置条件             | 用户输入登录信息                   |
| 后置条件             | 根据用户名和密码匹配返回相应的用户 |

| AccountService.getUserInfo |                                  |
| -------------------------- | -------------------------------- |
| 语法                       | User getUserInfo(int id);        |
| 前置条件                   | 无                               |
| 后置条件                   | 查找是否存在相应的用户，返回用户 |

| AccountService.updateUserInfo |                                                              |
| ----------------------------- | ------------------------------------------------------------ |
| 语法                          | ResponseVO updateUserInfo(int id, String password,String username,String phonenumber); |
| 前置条件                      | 用户输入想要修改的个人信息                                   |
| 后置条件                      | 查找是否存在相应的用户，更新用户信息                         |

| AccountService.updateCredit |                                             |
| --------------------------- | ------------------------------------------- |
| 语法                        | ResponseVO updateCredit(CreditVO creditVO); |
| 前置条件                    | 用户的信用值发生变化                        |
| 后置条件                    | 更新相关用户的信用值                        |

| AccountService.checkAllCredit |                                              |
| ----------------------------- | -------------------------------------------- |
| 语法                          | ResponseVO checkAllCredit(int id);           |
| 前置条件                      | 无                                           |
| 后置条件                      | 查找是否存在相应的用户，返回用户信用变化记录 |

| AccountService.updatePassword |                                                       |
| ----------------------------- | ----------------------------------------------------- |
| 语法                          | ResponseVO updatePassword(PasswordForm passwordForm); |
| 前置条件                      | 用户输入想要修改的密码信息                            |
| 后置条件                      | 查找相关用户，并更新该用户的密码                      |

需要的接口（需接口）

| 服务名                         | 服务                           |
| ------------------------------ | ------------------------------ |
| AccountMapper.createNewAccount | 数据库中新建一个客户对象       |
| AccountMapper.getAccountByName | 数据库中根据用户名查找用户     |
| AccountMapper.getAccountById   | 数据库中根据用户ID查找用户     |
| AccountMapper.updateAccount    | 数据库中更新用户信息           |
| AccountMapper.updateCredit     | 数据库中更新用户信用值         |
| AccountMapper.updatePassword   | 数据库中更新用户的密码         |
| CreditMapper.insertCredit      | 数据库中插入信用变更记录       |
| CreditMapper.checkAllCredit    | 数据库中查找所有的信用变更记录 |



##### 5.3.2.2 AdminService模块的接口规范

提供的服务（供接口）


| AdminService.getAllUsers |                           |
| ------------------------ | ------------------------- |
| 语法                     | List<User> getAllUsers(); |
| 前置条件                 | 无                        |
| 后置条件                 | 返回所有用户              |

| AdminService.getAllManagers |                              |
| --------------------------- | ---------------------------- |
| 语法                        | List<User> getAllManagers(); |
| 前置条件                    | 无                           |
| 后置条件                    | 返回所有酒店工作人员         |

| AdminService.addManager |                                       |
| ----------------------- | ------------------------------------- |
| 语法                    | ResponseVO addManager(UserVO userVO); |
| 前置条件                | 管理员输入网站工作人员信息            |
| 后置条件                | 添加网站工作人员                      |

| AdminService.addHotelManager |                                            |
| ---------------------------- | ------------------------------------------ |
| 语法                         | ResponseVO addHotelManager(UserVO userVO); |
| 前置条件                     | 管理员输入酒店工作人员信息                 |
| 后置条件                     | 添加酒店工作人员                           |

| AdminService.resetPassword |                                       |
| -------------------------- | ------------------------------------- |
| 语法                       | ResponseVO resetPassword(int userId); |
| 前置条件                   | 无                                    |
| 后置条件                   | 重置相关用户的密码                    |

需要的接口（需接口）

| 服务名                     | 服务                           |
| -------------------------- | ------------------------------ |
| AdminMapper.getAllUsers    | 数据库中查找所有的用户         |
| AdminMapper.getAllManagers | 数据库中查找所有的酒店工作人员 |
| AdminMapper.resetPassword  | 数据库中重置某用户的密码       |
| AdminMapper.addUser        | 数据库中新建一个用户           |



##### 5.3.2.3 CouponService模块的接口规范

提供的服务（供接口）


| CouponService.getMatchOrderCoupon |                                                    |
| --------------------------------- | -------------------------------------------------- |
| 语法                              | List<Coupon> getMatchOrderCoupon(OrderVO orderVO); |
| 前置条件                          | 生成新的订单信息                                   |
| 后置条件                          | 根据订单信息查找相应的优惠策略                     |

| CouponService.getHotelAllCoupon |                                                  |
| ------------------------------- | ------------------------------------------------ |
| 语法                            | List<Coupon> getHotelAllCoupon(Integer hotelId); |
| 前置条件                        | 无                                               |
| 后置条件                        | 根据酒店ID查找相应的优惠策略                     |

| CouponService.addHotelTargetMoneyCoupon |                                                              |
| --------------------------------------- | ------------------------------------------------------------ |
| 语法                                    | CouponVO addHotelTargetMoneyCoupon(HotelTargetMoneyCouponVO hotelTargetMoneyCouponVO); |
| 前置条件                                | 酒店工作人员输入新的满减优惠策略信息                         |
| 后置条件                                | 添加酒店满减优惠策略                                         |

| CouponService.updateHotelTargetMoneyCoupon |                                                              |
| ------------------------------------------ | ------------------------------------------------------------ |
| 语法                                       | CouponVO updateHotelTargetMoneyCoupon(HotelTargetMoneyCouponVO hotelTargetMoneyCouponVO); |
| 前置条件                                   | 酒店满减优惠策略已存在                                       |
| 后置条件                                   | 修改酒店满减优惠策略                                         |

| CouponService.addHotelTimeCoupon |                                                              |
| -------------------------------- | ------------------------------------------------------------ |
| 语法                             | CouponVO addHotelTimeCoupon(HotelTimeCouponVO hotelTimeCouponVO); |
| 前置条件                         | 酒店工作人员输入新的节日优惠策略信息                         |
| 后置条件                         | 添加酒店节日优惠策略                                         |

| CouponService.updateHotelTimeCoupon |                                                              |
| ----------------------------------- | ------------------------------------------------------------ |
| 语法                                | CouponVO updateHotelTimeCoupon(HotelTimeCouponVO hotelTimeCouponVO); |
| 前置条件                            | 酒店节日优惠策略已存在                                       |
| 后置条件                            | 修改酒店节日优惠策略                                         |

| CouponService.addHotelOfMultiCoupon |                                                              |
| ----------------------------------- | ------------------------------------------------------------ |
| 语法                                | CouponVO addHotelOfMultiCoupon(HotelOfMultiCouponVO hotelOfMultiCouponVO); |
| 前置条件                            | 酒店工作人员输入新的多间优惠策略信息                         |
| 后置条件                            | 添加酒店多间优惠策略                                         |

| CouponService.updateHotelOfMultiCoupon |                                                              |
| -------------------------------------- | ------------------------------------------------------------ |
| 语法                                   | CouponVO updateHotelOfMultiCoupon(HotelOfMultiCouponVO hotelOfMultiCouponVO); |
| 前置条件                               | 酒店多间优惠策略已存在                                       |
| 后置条件                               | 修改酒店多间优惠策略                                         |

| Coupon.getHotelCouponById |                                              |
| ------------------------- | -------------------------------------------- |
| 语法                      | Coupon getHotelCouponById(Integer couponId); |
| 前置条件                  | 优惠策略ID符合输入规则                       |
| 后置条件                  | 根据优惠策略ID查找优惠策略                   |

| Coupon.getWebAllCoupons |                                  |
| ----------------------- | -------------------------------- |
| 语法                    | List<Coupon> getWebAllCoupons(); |
| 前置条件                | 无                               |
| 后置条件                | 返回网站所有的优惠策略           |

需要的接口（需接口）

| 服务名                       | 服务                               |
| ---------------------------- | ---------------------------------- |
| CouponMapper.selectByHotelId | 数据库中根据酒店ID查找优惠策略     |
| CouponMapper.insertCoupon    | 数据库中新建一个优惠策略对象       |
| CouponMapper.updateCoupon    | 数据库中更新一个优惠策略对象       |
| CouponMapper.selectById      | 数据库中根据优惠策略ID查找优惠策略 |
| CouponMatchStrategy.isMatch  | 判断某个订单是否符合某个优惠策略   |
| CouponMapper.getWebAllCoupon | 数据库中查找网站的优惠策略         |



##### 5.3.2.4 HotelService模块的接口规范

提供的服务（供接口）


| HotelService.addHotel |                                                         |
| --------------------- | ------------------------------------------------------- |
| 语法                  | void addHotel(HotelVO hotelVO) throws ServiceException; |
| 前置条件              | 酒店信息输入符合输入规则、数据要求                      |
| 后置条件              | 查看是否存在相应的酒店工作人员；酒店创建成功或失败      |

| HotelService.updateHotel |                                   |
| ------------------------ | --------------------------------- |
| 语法                     | void updateHotel(HotelVO hotelVO) |
| 前置条件                 | 酒店工作人员修改酒店的信息        |
| 后置条件                 | 更新相关酒店信息                  |

| HotelService.retrieveHotels |                                 |
| --------------------------- | ------------------------------- |
| 语法                        | List<HotelVO> retrieveHotels(); |
| 前置条件                    | 无                              |
| 后置条件                    | 查找所有的酒店信息              |

| HotelService.retrieveHotelDetails |                                                |
| --------------------------------- | ---------------------------------------------- |
| 语法                              | HotelVO retrieveHotelDetails(Integer hotelId); |
| 前置条件                          | 无                                             |
| 后置条件                          | 查找是否存在相应的酒店，返回酒店信息           |

| HotelService.getHotelRooms |                                                       |
| -------------------------- | ----------------------------------------------------- |
| 语法                       | List<RoomVO> getHotelRooms(HotelRoomsVO hotelRoomsVO) |
| 前置条件                   | 无                                                    |
| 后置条件                   | 返回相关酒店剩余房间信息                              |

| HotelService.addComment |                                             |
| ----------------------- | ------------------------------------------- |
| 语法                    | ResponseVO addComment(CommentVO commentVO); |
| 前置条件                | 客户填写评论信息                            |
| 后置条件                | 更新相关酒店评论信息                        |

| HotelService.checkComment |                                       |
| ------------------------- | ------------------------------------- |
| 语法                      | ResponseVO checkComment(int hotelId); |
| 前置条件                  | 无                                    |
| 后置条件                  | 返回相关酒店所有评论信息              |

| HotelService.retrieveHotelsByManager |                                                       |
| ------------------------------------ | ----------------------------------------------------- |
| 语法                                 | List<HotelVO> retrieveHotelsByManager(int managerId); |
| 前置条件                             | 无                                                    |
| 后置条件                             | 返回相关酒店工作人员旗下酒店的信息                    |

需要的接口（需接口）

| 服务名                              | 服务                             |
| ----------------------------------- | -------------------------------- |
| HotelMapper.insertHotel             | 数据库中新建一个酒店对象         |
| HotelMapper.selectAllHotel          | 数据库中查找所有的酒店           |
| HotelMapper.selectById              | 数据库中根据酒店ID查找酒店       |
| HotelMapper.updateHotel             | 数据库中更新酒店信息             |
| HotelMapper.updateRate              | 数据库中更新酒店的评分           |
| HotelMapper.retrieveHotelsByManager | 数据库中根据酒店工作人员查找酒店 |
| OrderMapper.getOrderNumByDate       | 数据库中根据日期查找订单数       |
| OrderMapper.updateOrderState        | 数据库中更新订单状态             |
| AccountService.getUserInfo          | 获取用户个人信息                 |
| RoomService.retrieveHotelRoomInfo   | 获取某个酒店的全部房间信息       |
| CommentMapper.addComment            | 数据库中新建评论对象             |
| CommentMapper.checkComment          | 数据库中查找酒店的所有评论       |



##### 5.3.2.5 OrderService模块的接口规范

提供的服务（供接口）


| OrderService.addOrder |                                                    |
| --------------------- | -------------------------------------------------- |
| 语法                  | ResponseVO addOrder(OrderVO orderVO);              |
| 前置条件              | 订单信息符合输入规则、数据要求                     |
| 后置条件              | 查找是否有足够多相应类型的房间；订单创建成功或失败 |

| OrderService.getAllOrders |                             |
| ------------------------- | --------------------------- |
| 语法                      | List<Order> getAllOrders(); |
| 前置条件                  | 无                          |
| 后置条件                  | 查找所有的订单信息          |

| OrderService.getUserOrders |                                        |
| -------------------------- | -------------------------------------- |
| 语法                       | List<Order> getUserOrders(int userid); |
| 前置条件                   | 无                                     |
| 后置条件                   | 根据用户ID查找相应的订单               |

| OrderService.getManagerOrders |                                              |
| ----------------------------- | -------------------------------------------- |
| 语法                          | List<Order> getManagerOrders(int managerId); |
| 前置条件                      | 无                                           |
| 后置条件                      | 根据酒店管理人员查找订单                     |
|                               |                                              |

| OrderService.annulOrder |                                     |
| ----------------------- | ----------------------------------- |
| 语法                    | ResponseVO annulOrder(int orderid); |
| 前置条件                | 无                                  |
| 后置条件                | 根据订单ID查找相应的订单并撤销订单  |

| OrderService.getHotelOrders |                                              |
| --------------------------- | -------------------------------------------- |
| 语法                        | List<Order> getHotelOrders(Integer hotelId); |
| 前置条件                    | 无                                           |
| 后置条件                    | 根据酒店ID查找相应酒店的订单                 |

| OrderService.getOrderDetail |                                    |
| --------------------------- | ---------------------------------- |
| 语法                        | Order getOrderDetail(int orderId); |
| 前置条件                    | 无                                 |
| 后置条件                    | 根据订单ID查找订单                 |

| OrderService.executeOrder |                                       |
| ------------------------- | ------------------------------------- |
| 语法                      | ResponseVO executeOrder(int orderId); |
| 前置条件                  | 无                                    |
| 后置条件                  | 更新相关订单状态为已执行              |

| OrderService.checkException |                        |
| --------------------------- | ---------------------- |
| 语法                        | void checkException(); |
| 前置条件                    | 无                     |
| 后置条件                    | 更新相关订单状态为异常 |

需要的接口（需接口）

| 服务名                       | 服务                               |
| ---------------------------- | ---------------------------------- |
| OrderMapper.addOrder         | 数据库中新建一个订单对象           |
| OrderMapper.getAllOrders     | 数据库中查找所有的订单             |
| OrderMapper.getUserOrders    | 数据库中根据用户ID查找订单         |
| OrderMapper.getManagerOrders | 数据库中根据酒店工作人员ID查找订单 |
| OrderMapper.getOrderById     | 数据库中根据订单ID查找订单         |
| OrderMapper.annulOrder       | 数据库中根据订单ID查找并撤销订单   |
| OrderMapper.updateOrderState | 数据库中更新订单状态               |
| AccountService.updateCredit  | 更新用户的信用值                   |
| AccountMapper.getAccountById | 数据库中查找用户                   |



##### 5.3.2.6 RoomService模块的接口规范

提供的服务（供接口）


| RoomService.retrieveHotelRoomInfo |                                                         |
| --------------------------------- | ------------------------------------------------------- |
| 语法                              | List<HotelRoom> retrieveHotelRoomInfo(Integer hotelId); |
| 前置条件                          | 无                                                      |
| 后置条件                          | 根据酒店ID查找相应的酒店房间信息                        |

| RoomService.insertRoomInfo |                                           |
| -------------------------- | ----------------------------------------- |
| 语法                       | void insertRoomInfo(HotelRoom hotelRoom); |
| 前置条件                   | 酒店房间信息输入符合输入规则、数据要求    |
| 后置条件                   | 酒店房间创建成功                          |

需要的接口（需接口）

| 服务名                          | 服务                           |
| ------------------------------- | ------------------------------ |
| RoomMapper.insertRoom           | 数据库中新建一个房间对象       |
| RoomMapper.selectRoomsByHotelId | 数据库中根据酒店ID查找房间信息 |



### 5.4 数据层分解

数据层主要给业务逻辑层提供数据访问服务，包括对于持久化数据的增、删、改、查。

模块设计和各个模块所提供的服务分别如下图所示。

<img src="https://software-engineering.oss-cn-beijing.aliyuncs.com/dataLayerModule2.png" style="zoom:50%;" />


#### 5.4.1 数据层模块的职责

数据层模块的职责如下表xx所示。

**表 数据层模块的职责**


| 模块          | 职责                                                         |
| ------------- | ------------------------------------------------------------ |
| AdminMapper   | 基于 sql 数据库的持久化数据库的接口，提供酒店工作人员信息相关的增删改查服务 |
| CouponMapper  | 基于 sql 数据库的持久化数据库的接口，提供优惠券信息相关的增删改查服务 |
| HotelMapper   | 基于 sql 数据库的持久化数据库的接口，提供酒店信息相关的增删改查服务 |
| RoomMapper    | 基于 sql 数据库的持久化数据库的接口，提供酒店房间信息相关的增删改查服务 |
| OrderMapper   | 基于 sql 数据库的持久化数据库的接口，提供预定订单信息相关的增删改查服务 |
| AccountMapper | 基于 sql 数据库的持久化数据库的接口，提供客户信息相关的增删改查服务 |
| CommentMapper | 基于 sql 数据库的持久化数据库的接口，提供订单评论信息相关的增删改查服务 |
| CreditMapper  | 基于 sql 数据库的持久化数据库的接口，提供客户信用信息相关的增删改查服务 |

#### 5.4.2 接口规范

##### 5.4.2.1 AdminMapper模块的接口规范


| 提供的接口                 |                                 |                                                              |
| -------------------------- | ------------------------------- | ------------------------------------------------------------ |
| AdminMapper.addManager     | 语法<br>前置条件<br>后置条件    | int addManager(User user)<br>获得一份酒店工作人员的信息<br>添加一个酒店工作人员 |
| AdminMapper.getAllManagers | 语法<br/>前置条件<br/>后置条件  | List<`User`> getAllManagers()<br>无<br>获取所有酒店工作人员  |
| AdminMapper.getAllUsers    | 语法<br>前置条件<br />后置条件  | List<User> getAllUsers();<br />无<br />获取所有用户          |
| AdminMapper.resetPassword  | 语法<br/>前置条件<br />后置条件 | void resetPassword(int userId);<br />无<br />重置相关用户密码 |



##### 5.4.2.2 CouponMapper模块的接口规范


| 提供的接口                   |                                |                                                              |
| ---------------------------- | ------------------------------ | ------------------------------------------------------------ |
| CouponMapper.insertCoupon    | 语法<br>前置条件<br>后置条件   | int insertCoupon(Coupon coupon)<br>无<br>添加一个优惠券      |
| CouponMapper.updateCoupon    | 语法<br/>前置条件<br/>后置条件 | int updateCoupon(Coupon coupon)<br>无<br>更新一个优惠券内容  |
| CouponMapper.selectByHotelId | 语法<br/>前置条件<br/>后置条件 | List<`Coupon`> selectByHotelId(Integer hotelId) <br>无<br>查看某酒店所有优惠券 |
| CouponMapper.getWebAllCoupon | 语法<br/>前置条件<br/>后置条件 | List<Coupon> getWebAllCoupon();<br />无<br />查找网站所有的优惠策略 |
| CouponMapper.selectById      | 语法<br/>前置条件<br/>后置条件 | Coupon selectById(Integer id)<br>无<br>根据id查看优惠券内容  |



##### 5.4.2.3 HotelMapper模块的接口规范


| 提供的接口                         |                                |                                                              |
| ---------------------------------- | ------------------------------ | ------------------------------------------------------------ |
| HotelMapper.insertHotel            | 语法<br>前置条件<br>后置条件   | int insertHotel(Hotel hotel)<br>无<br>添加一家酒店           |
| HotelMapper.selectAllHotel         | 语法<br/>前置条件<br/>后置条件 | List<`HotelVO`> selectAllHotel()<br>无<br>获取所有酒店       |
| HotelMapper.selectById             | 语法<br/>前置条件<br/>后置条件 | HotelVO selectById(Integer id)<br>无<br>根据id获取酒店信息   |
| HotelMapper.updateRate             | 语法<br/>前置条件<br/>后置条件 | void updateRate(Integer hotelId);<br />无<br />更新酒店评分  |
| HotelMapper.retrieveHotelByManager | 语法<br/>前置条件<br/>后置条件 | List<HotelVO> retrieveHotelsByManager(int managerId);<br />无<br />根据酒店工作人员查找酒店 |
| Hotel.updateHotel                  | 语法<br/>前置条件<br/>后置条件 | void updateHotel(Hotel hotel);<br />获得修改的酒店信息<br />更改相关酒店信息 |



##### 5.4.2.4 RoomMapper模块的接口规范


| 提供的接口                      |                                |                                                              |
| ------------------------------- | ------------------------------ | ------------------------------------------------------------ |
| RoomMapper.insertRoom           | 语法<br/>前置条件<br/>后置条件 | int insertRoom(HotelRoom hotelRoom)<br>获得新的酒店房间信息<br>添加酒店房间 |
| RoomMapper.selectRoomsByHotelId | 语法<br/>前置条件<br/>后置条件 | List<`HotelRoom`> selectRoomsByHotelId(Integer hotelId)<br>无<br>根据id获取酒店房间信息 |



##### 5.4.2.5 OrderMapper模块的接口规范


| 提供的接口                    |                                |                                                              |
| ----------------------------- | ------------------------------ | ------------------------------------------------------------ |
| OrderMapper.addOrder          | 语法<br>前置条件<br>后置条件   | int addOrder(Order order)<br>获得新的订单信息<br>添加一个订单 |
| OrderMapper.getAllOrders      | 语法<br/>前置条件<br/>后置条件 | List<`Order`> getAllOrders()<br>无<br>获取所有订单           |
| OrderMapper.getUserOrders     | 语法<br/>前置条件<br/>后置条件 | List<`Order`> getUserOrders( int userid)<br>无<br>获取某客户的所有订单 |
| OrderMapper.updateOrderState  | 语法<br/>前置条件<br/>后置条件 | int updateOrderState(int orderId, OrderStateType stateType);<br>获得新的订单状态信息<br>更新相关订单的状态 |
| OrderMapper.getOrderById      | 语法<br/>前置条件<br/>后置条件 | Order getOrderById( int orderid)<br/>无<br>获取订单信息      |
| OrderMapper.getHotelAllOrders | 语法<br/>前置条件<br/>后置条件 | List<Order> getHotelAllOrders(int hotelId);<br />无<br />根据酒店ID获取订单信息 |
| OrderMapper.getOrderNumByDate | 语法<br/>前置条件<br/>后置条件 | Integer getOrderNumByDate(int hotelId, RoomType roomType, String date);<br />无<br />根据酒店ID、房间类型和日期获取订单的数量 |
| OrderMapper.checkException    | 语法<br/>前置条件<br/>后置条件 | void checkException();<br />无<br />检查异常订单             |
| OrderMapper.getManagerOrders  | 语法<br/>前置条件<br/>后置条件 | List<Order> getManagerOrders(int managerId);<br />无<br />根据酒店工作人员ID查找订单 |



##### 5.4.2.6 AccountMapper模块的接口规范

| 提供的接口                     |                                |                                                              |
| ------------------------------ | ------------------------------ | ------------------------------------------------------------ |
| AccountMapper.createNewAccount | 语法<br>前置条件<br>后置条件   | int createNewAccount(User user)<br>无<br>添加一个客户        |
| AccountMapper.getAccountByName | 语法<br/>前置条件<br/>后置条件 | User getAccountByName( String email)<br>无<br>根据邮箱获取客户信息 |
| AccountMapper.getAccountById   | 语法<br/>前置条件<br/>后置条件 | User getAccountById( int id)<br>无<br>根据id获取客户信息     |
| AccountMapper.updateAccount    | 语法<br/>前置条件<br/>后置条件 | int updateAccount( int id,  String password, String username, String phonenumber)<br>无<br>更新一个客户信息 |
| AccountMapper.updateCredit     | 语法<br/>前置条件<br/>后置条件 | int updateCredit(int userId, double result);<br />无<br />更新客户的信用值 |
| Account.updatePassword         | 语法<br/>前置条件<br/>后置条件 | int updatePassword(int userId, String password);<br />无<br />更新用户的密码 |



##### 5.4.2.7 CommentMapper模块的接口规范

| 提供的接口           |                                |                                                              |
| -------------------- | ------------------------------ | ------------------------------------------------------------ |
| Comment.addComment   | 语法<br/>前置条件<br/>后置条件 | int addComment(CommentVO commentVO);<br />获得新的评论信息<br />添加一个评论 |
| Comment.checkComment | 语法<br/>前置条件<br/>后置条件 | List<Comment> checkComment(int hotelId);<br />无<br />根据酒店ID获取评论 |



##### 5.4.2.8 CreditMapper模块的接口规范

| 提供的接口                  |                                |                                                              |
| --------------------------- | ------------------------------ | ------------------------------------------------------------ |
| CreditMapper.insertCredit   | 语法<br/>前置条件<br/>后置条件 | int insertCredit(CreditVO creditVO);<br/>获得新的信用值信息<br/>更新相关客户的信用值 |
| CreditMapper.checkAllCredit | 语法<br/>前置条件<br/>后置条件 | List<CreditVO> checkAllCredit(int id);<br/>无<br/>查看某客户所有的信用值变化 |



## 6.信息视角

### 6.1 数据持久化对象

在此对系统的实体类PO做简单的介绍：

* **coupon:** 

  描述、可优惠酒店、类型、名称、达标金额、优惠金额、折扣、状态、有效开始日期、截止日期

  > * id(键)
  > * description(描述)
  > * hotelId(可优惠酒店的id，-1代表所有酒店)
  > * couponType(优惠券类型，1为多间优惠，2为节日优惠、3为满减优惠)
  > * couponName(优惠券名称)
  > * target_money(达标金额)
  > * multiThreshold(多件优惠使用标准)
  > * discount_money(优惠金额)
  > * discount(折扣，满减优惠为0)
  > * status(状态，1有效，0失效)
  > * start_time(有效开始日期)
  > * end_time(截止日期)

* **hotel**

  名称、描述、地址、区域、星级、联系电话、评分、酒店管理人员

  > * id(键)
  > * hotelName
  > * description
  > * address
  > * bizRegion(区域)
  > * hotelStar
  > * phoneNum
  > * rate(评分)
  > * manager_id(唯一的酒店管理人员id)

* **HotelRoom**

  价格、剩余房间数、总房间数、所属酒店、房间类型

  > * id
  > * price
  > * total
  > * hotelId
  > * roomType

* **user**

  名称、密码、邮箱地址、联系电话、信用值、用户类型

  > * id
  > * email
  > * password
  > * username
  > * phonenumber
  > * credit
  > * usertype

* **order**

  客户、酒店、酒店名、入住时间、退房时间、房间类型、房间数量、入住人数、是否带儿童、订单创建时间、订单价格、客户名称、客户电话、订单状态

  > * id
  > * userId
  > * hotelId
  > * hotelName
  > * checkInDate
  > * checkOutDate
  > * roomType
  > * roomNum
  > * peopleNum
  > * haveChild
  > * createDate
  > * price
  > * clientName
  > * phoneNumber
  > * orderState

* **comment**

  评论时间、酒店、订单、客户、分数、评价内容

  > * id
  > * createTime
  > * hotelId
  > * orderId
  > * username
  > * grade
  > * content

* **credit**

  用户、信用值变化原因、时间、订单、加减、改变数量、结果

  > * id
  > * userId
  > * actionType
  > * time
  > * orderId
  > * sign
  > * changeNum
  > * result

例如，持久化用户User的定义如下所示

```java
public class User {
    private Integer id;
    private String email;
    private String password;
    private String userName;
    private String phoneNumber;
    private double credit;
    private UserType userType;

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public String getUserName() {
        return userName;
    }

    public void setUserName(String userName) {
        this.userName = userName;
    }

    public String getPhoneNumber() {
        return phoneNumber;
    }

    public void setPhoneNumber(String phoneNumber) {
        this.phoneNumber = phoneNumber;
    }

    public double getCredit() {
        return credit;
    }

    public void setCredit(double credit) {
        this.credit = credit;
    }

    public String getEmail() {
        return email;
    }

    public void setEmail(String email) {
        this.email = email;
    }

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }

    public UserType getUserType() {
        return userType;
    }

    public void setUserType(UserType userType) {
        this.userType = userType;
    }
}


```

### 6.2 数据库表

数据库中包含coupon表、hotel表、orderlist表、room表、user表

